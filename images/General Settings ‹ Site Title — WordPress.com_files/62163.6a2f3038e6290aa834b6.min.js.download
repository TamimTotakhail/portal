"use strict";(globalThis.webpackChunkcalypso=globalThis.webpackChunkcalypso||[]).push([[62163],{"./lib/query-manager/post/constants.js":(e,t,s)=>{s.d(t,{e:()=>r});const r={context:"display",http_envelope:!1,pretty:!1,number:20,offset:0,page:1,order:"DESC",order_by:"date",type:"post",status:"publish",sticky:"include",search:""}},"./state/posts/constants.js":(e,t,s)=>{s.d(t,{e:()=>r,h:()=>a});const r={context:"display",http_envelope:!1,pretty:!1,number:20,offset:0,page:1,order:"DESC",order_by:"date",type:"post",status:"publish",sticky:"include",search:""},a=["publish","draft","pending","private","future","trash"]},"./state/posts/init.js":(e,t,s)=>{var r=s("./state/redux-store.ts"),a=s("../node_modules/lodash-es/reduce.js"),n=s("../node_modules/lodash-es/findKey.js"),i=s("../node_modules/lodash-es/omit.js"),o=s("../node_modules/lodash-es/mapValues.js"),u=s("../node_modules/lodash-es/get.js"),d=s("../node_modules/lodash-es/merge.js"),c=s("../node_modules/lodash-es/omitBy.js"),l=s("../node_modules/lodash-es/isEqual.js"),p=s("../node_modules/lodash-es/isEmpty.js"),m=s("../node_modules/lodash-es/set.js"),I=s("../node_modules/lodash-es/mapKeys.js"),h=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),f=s("../node_modules/lodash-es/some.js"),y=s("../node_modules/moment/moment.js"),Z=s.n(y),_=s("./lib/query-manager/paginated/index.js"),g=s("./lib/query-manager/post/constants.js"),D=s("./lib/query-manager/paginated/key.js");function b(e,t){return null==e||g.e[t]===e}class k extends D.Z{static stringify(e){return super.stringify((0,c.Z)(e,b))}static parse(e){return(0,c.Z)(super.parse(e),b)}}class v extends _.Z{static matches(e,t){const s=Object.assign({},this.DefaultQuery,e);return Object.entries(s).every((([e,s])=>{switch(e){case"search":{if(!s)return!0;const e=s.toLowerCase();return t.title&&t.title.toLowerCase().includes(e)||t.content&&t.content.toLowerCase().includes(e)}case"after":case"before":case"modified_after":case"modified_before":{const r=Z()(s,Z().ISO_8601),a=/after$/.test(e)?"isAfter":"isBefore",n=/^modified_/.test(e)?"modified":"date";return r.isValid()&&Z()(t[n])[a](r)}case"term":return Object.entries(s).every((([e,s])=>(s=s.split(","),(0,f.Z)(t.terms[e],(({slug:e})=>s.includes(e))))));case"tag":case"category":{if(!s)return!0;const r=s.toLowerCase(),a="tag"===e?"tags":"categories";return(0,f.Z)(t[a],(({name:e,slug:t})=>e&&e.toLowerCase()===r||t&&t.toLowerCase()===r))}case"type":return"any"===s||s===t.type;case"parent_id":return s===t.parent||t.parent&&s===t.parent.ID;case"exclude":return Array.isArray(s)?!s.includes(t.ID):s!==t.ID;case"sticky":return"require"===s?t.sticky:"exclude"!==s||!t.sticky;case"author":return(0,u.Z)(t,"author.ID",t.author)===s;case"status":return"any"===s||String(s).split(",").some((s=>s===t[e]))}return!0}))}static compare(e,t,s){let r;switch(e.order_by){case"ID":r=t.ID-s.ID;break;case"comment_count":r=(0,u.Z)(t.discussion,"comment_count",0)-(0,u.Z)(s.discussion,"comment_count",0);break;case"title":r=t.title.localeCompare(s.title);break;case"modified":r=new Date(t.modified)-new Date(s.modified);break;default:r=new Date(t.date)-new Date(s.date)}return e.order&&!/^desc$/i.test(e.order)||(r*=-1),r||0}}(0,h.Z)(v,"QueryKey",k),(0,h.Z)(v,"DefaultQuery",g.e);var j=s("./lib/query-manager/with-query-manager.js"),w=s("./state/action-types.ts");var L=s("./state/utils/schema-utils.js"),q=s("./state/utils/with-persistence.ts"),P=s("./state/utils/reducer-utils.ts"),E=s("../node_modules/lodash-es/pick.js");const N={type:"object",patternProperties:{"^[0-9]+$":{type:"object",patternProperties:{"^[\\w-]+$":{type:"object",patternProperties:{"^(all|mine)$":{type:"object",patternProperties:{"^\\w+$":{type:"integer"}},additionalProperties:!1}},additionalProperties:!1}},additionalProperties:!1}},additionalProperties:!1};const O=(()=>{let e,t={};function s(e,t){return[e,t].join()}function r(r,a,n,o){const c=s(a,n),l=t[c];if(!l)return r;const p=["all"];l.authorId===e&&p.push("mine");const m=p.reduce(((e,t)=>{const s=(0,u.Z)(r,[a,l.type,t],{});return e[t]={},e[t][l.status]=Math.max((s[l.status]||0)-1,0),"deleted"!==o&&(e[t][o]=(s[o]||0)+1),e}),{});return"deleted"===o?t=(0,i.Z)(t,c):l.status=o,(0,d.Z)(m,{all:{},mine:{}}),(0,d.Z)({},r,{[a]:{[l.type]:m}})}return(0,L.G)(N,((a={},n)=>{switch(n.type){case w.Rp6:return e=void 0,t={},a;case w.uBM:return e=n.user.ID,a;case w.hYA:return n.posts.forEach((e=>{const n=s(e.site_ID,e.ID),i=t[n];i&&e.status!==i.status&&(a=r(a,e.site_ID,e.ID,e.status)),t[n]=(0,E.Z)(e,"type","status"),t[n].authorId=(0,u.Z)(e.author,"ID")})),a;case w.CNw:{const{siteId:e,postId:t,post:s}=n;return s.status?r(a,e,t,s.status):a}case w.LbL:return r(a,n.siteId,n.postId,"deleted");case w.C6k:return(0,d.Z)({},a,{[n.siteId]:{[n.postType]:n.counts}})}return a}))})(),A=(0,P.U)({requesting:function(e={},t){switch(t.type){case w.T3s:case w.h2B:case w.X5K:return(0,d.Z)({},e,{[t.siteId]:{[t.postType]:w.T3s===t.type}})}return e},counts:O});var U=s("./state/utils/keyed-reducer.ts");const C=(0,L.G)({type:"object",additionalProperties:!1,required:["iLike","found"],properties:{likes:{type:"array",description:"List of post likes"},iLike:{type:"boolean",description:"Whether the current authenticated user likes the post or not"},found:{type:"number",description:"The total of post likes"},lastUpdated:{type:"number",description:"When we last updated the liker info"}}},((e={likes:void 0,iLike:!1,found:0,lastUpdated:void 0},t)=>{switch(t.type){case w.AVO:{const{likes:s,iLike:r,found:a}=t;return{likes:Array.isArray(s)?s.map((e=>({ID:e.ID,avatar_URL:e.avatar_URL,login:e.login,name:e.name,site_ID:e.site_ID,site_visible:e.site_visible}))):e.likes,iLike:r,found:a,lastUpdated:Date.now()}}case w.RFP:return e.iLike?e:{likes:e.likes,iLike:!0,found:e.found+1,lastUpdated:e.lastUpdated};case w.vP0:return e.iLike?{likes:e.likes,iLike:!1,found:Math.max(0,e.found-1),lastUpdated:e.lastUpdated}:e;case w.rgA:{const{likeCount:s,liker:r}=t,a=(0,f.Z)(e.likes,(e=>e.ID===r.ID));if(e.found===s&&a)return e;let n=e.likes;return a||(n=[r,...e.likes||[]]),{likes:n,iLike:e.iLike,found:s,lastUpdated:e.lastUpdated}}case w.a7F:{const{likeCount:s,liker:r}=t,a=(0,f.Z)(e.likes,(e=>e.ID===r.ID));if(e.found===s&&!a)return e;let n=e.likes;return a&&(n=e.likes.filter((e=>r.ID!==e.ID))),{likes:n,iLike:e.iLike,found:s,lastUpdated:e.lastUpdated}}}return e})),x=(0,U.J)("siteId",(0,U.J)("postId",C)),R=(0,P.U)({items:x});var T=s("../node_modules/lodash-es/filter.js"),$=s("../node_modules/lodash-es/keyBy.js");const z=(0,P.U)({items:function(e={},t){return t.type===w.R$r?(0,a.Z)(t.users,((t,s)=>(t===e&&(t={...e}),t[s.ID]=s,t)),e):e}});const M=(0,P.U)({diffs:function(e={},{diffs:t,postId:s,revisions:r,siteId:a,type:n}){if(n!==w.vIA)return e;if(!Number.isInteger(a)||a<=0)return e;const o=(0,u.Z)(e,[a,s],{}),d={...(0,u.Z)(o,"revisions",{}),...r},c=(0,T.Z)(t,(({diff:e,from:t,to:s})=>!(!Number.isInteger(t)||t<0)&&(!(!Number.isInteger(s)||s<1)&&((0===t||!(0,p.Z)(d[t]))&&(!(0,p.Z)(d[s])&&!(0,p.Z)(e))))));return(0,p.Z)(c)?e:{...e,[a]:{...e[a],[s]:{...{...(0,i.Z)(o,"revisions"),...(0,$.Z)(c,(e=>`${e.from}:${e.to}`))},revisions:d}}}},selection:function(e={},t){switch(t.type){case w.N__:return{...e,revisionId:t.revisionId};case w.oD3:case w.bgv:return{...e,revisionId:null};default:return e}},ui:function(e={},t){switch(t.type){case w.NYz:return{...e,isDialogVisible:!1};case w.gpX:return{...e,isDialogVisible:!0};case w.Se1:return{...e,diffView:"split"};case w.bE0:return{...e,diffView:"unified"};default:return e}},authors:z});var G=s("./lib/query-manager/schema.js");const S={type:"object",patternProperties:{"^\\d+$":G.Z},additionalProperties:!1};var B=s("./state/posts/utils/get-serialized-posts-query.js"),V=s("../node_modules/lodash-es/cloneDeep.js"),F=s("../node_modules/lodash-es/map.js");const W=(e,t)=>{if(t.length>1){const[,...s]=t;W(e[t[0]],s)}else e&&e.hasOwnProperty(t[0])&&delete e[t[0]]};function Y(e){const t=(0,V.Z)(e);return(0,a.Z)([[],...(0,a.Z)(e.terms,((e,t,s)=>e.concat((0,F.Z)(t,((e,t)=>["terms",s,t])))),[]),...(0,F.Z)(e.categories,((e,t)=>["categories",t])),...(0,F.Z)(e.tags,((e,t)=>["tags",t])),...(0,F.Z)(e.attachments,((e,t)=>["attachments",t]))],((e,t)=>(W(e,t.concat("meta","links")),e)),t)}var J=s("./state/posts/utils/merge-post-edits.js");var K=s("../node_modules/lodash-es/xor.js");var Q=s("../node_modules/lodash-es/find.js");function X(e,t){return(0,T.Z)(e,(e=>function(e,t){const s=(0,Q.Z)(t,{key:e.key});return"update"===e.operation?!s||s.value!==e.value:"delete"===e.operation&&!!s}(e,t)))}var H=s("../node_modules/lodash-es/last.js");const ee=(0,L.G)({type:"object",patternProperties:{"^\\w+$":{type:"array",items:{type:"number"},minItems:2,maxItems:2}},additionalProperties:!1},((e={},t)=>{switch(t.type){case w.hYA:return(0,a.Z)(t.posts,((t,s)=>{const{site_ID:r,ID:a,global_ID:n}=s;return t[n]||(t===e&&(t={...t}),t[n]=[r,a]),t}),e);case w.kNW:{const s=(0,n.Z)(e,(([e,s])=>e===t.siteId&&s===t.postId));return s?(0,i.Z)(e,s):e}}return e}));const te=(0,L.G)(S,(0,q.$)(((e={},t)=>{switch(t.type){case w.A4M:{const{siteId:s,query:r,posts:a,found:n}=t;if(!s)return e;const i=a.map(Y);return(0,j.Z)(e,s,(e=>e.receive(i,{query:r,found:n})),(()=>new v))}case w.hYA:{const{posts:s}=t,r=(0,a.Z)(s,((e,t)=>Object.assign(e,{[t.site_ID]:[...e[t.site_ID]||[],Y(t)]})),{});return(0,a.Z)(r,((e,t,s)=>(0,j.Z)(e,s,(e=>e.receive(t)),(()=>new v))),e)}case w.F1Z:{const{siteId:s,postId:r}=t;return(0,j.Z)(e,s,(e=>e.receive({ID:r,status:"__RESTORE_PENDING"},{patch:!0})))}case w.JZv:{const{siteId:s,postId:r}=t;return(0,j.Z)(e,s,(e=>e.receive({ID:r,status:"trash"},{patch:!0})))}case w.CNw:{const{siteId:s,postId:r,post:a}=t;return(0,j.Z)(e,s,(e=>e.receive({ID:r,...a},{patch:!0})))}case w.LbL:{const{siteId:s,postId:r}=t;return(0,j.Z)(e,s,(e=>e.receive({ID:r,status:"__DELETE_PENDING"},{patch:!0})))}case w.xkR:{const{siteId:s,postId:r}=t;return(0,j.Z)(e,s,(e=>e.receive({ID:r,status:"trash"},{patch:!0})))}case w.kNW:{const{siteId:s,postId:r}=t;return(0,j.Z)(e,s,(e=>e.removeItem(r)))}}return e}),{serialize:e=>(0,o.Z)(e,(({data:e,options:t})=>({data:e,options:t}))),deserialize:e=>(0,o.Z)(e,(({data:e,options:t})=>new v(e,t)))}));function se(e,t,s){return(0,n.Z)(e.data.items,(e=>e.site_ID===t&&e.ID===s))||null}const re=(0,L.G)(G.Z,(0,q.$)(((e=new v({},{itemKey:"global_ID"}),t)=>{switch(t.type){case w.A4M:{const{siteId:s,query:r,posts:a,found:n}=t;return s?e:e.receive(a.map(Y),{query:r,found:n})}case w.hYA:{const{posts:s}=t;return e.receive(s)}case w.F1Z:{const{siteId:s,postId:r}=t,a=se(e,s,r);return e.receive({global_ID:a,status:"__RESTORE_PENDING"},{patch:!0})}case w.JZv:{const{siteId:s,postId:r}=t,a=se(e,s,r);return e.receive({global_ID:a,status:"trash"},{patch:!0})}case w.CNw:{const{siteId:s,postId:r,post:a}=t,n=se(e,s,r);return e.receive({global_ID:n,...a},{patch:!0})}case w.LbL:{const{siteId:s,postId:r}=t,a=se(e,s,r);return e.receive({global_ID:a,status:"__DELETE_PENDING"},{patch:!0})}case w.xkR:{const{siteId:s,postId:r}=t,a=se(e,s,r);return e.receive({global_ID:a,status:"trash"},{patch:!0})}case w.kNW:{const{siteId:s,postId:r}=t,a=se(e,s,r);return e.removeItem(a)}}return e}),{serialize:({data:e,options:t})=>({data:e,options:t}),deserialize:({data:e,options:t})=>new v(e,t)}));const ae=(0,P.U)({counts:A,items:ee,siteRequests:function(e={},t){switch(t.type){case w.pgH:case w.nL0:case w.Ra4:return Object.assign({},e,{[t.siteId]:Object.assign({},e[t.siteId],{[t.postId]:w.pgH===t.type})})}return e},queryRequests:function(e={},t){switch(t.type){case w.XMF:case w.A4M:case w.LEp:const s=(0,B.v)(t.query,t.siteId);return Object.assign({},e,{[s]:w.XMF===t.type})}return e},queries:te,allSitesQueries:re,edits:function(e={},t){switch(t.type){case w.hYA:return(0,a.Z)(t.posts,((s,r)=>{let a=(0,u.Z)(s,[r.site_ID,r.ID]);if(!a)return s;if(s===e&&(s=(0,d.Z)({},e)),t.saveMarker){const e=a.indexOf(t.saveMarker);-1!==e&&(a=a.slice(e+1))}const n=(0,J.Z)(...a);let i=null;if(n){const e=(0,c.Z)(n,((e,t)=>{switch(t){case"author":return m=e,I=r[t],(0,u.Z)(m,"ID")===(0,u.Z)(I,"ID");case"date":return c=e,p=r[t],!1===c||c&&new Date(c).getTime()===new Date(p).getTime();case"discussion":return o=e,d=r[t],Object.entries(o).every((([e,t])=>(0,u.Z)(d,[e])===t));case"featured_image":return e===function(e){if(e)return"featured_image"in e&&!/^https?:\/\//.test(e.featured_image)?e.featured_image:e.post_thumbnail?e.post_thumbnail.ID:void 0}(r);case"metadata":return!0;case"status":return n=e,i=r[t],["publish","future"].includes(n)?["publish","future"].includes(i):n===i;case"terms":return s=e,a=r[t],Object.entries(s).every((([e,t])=>{const s=Object.values(t),r="object"==typeof s[0]&&null!==s[0],n=r?(0,F.Z)(s,"ID"):s,i=r?"ID":"name",o=(0,F.Z)(a[e],i);return!(0,K.Z)(n,o).length}))}var s,a,n,i,o,d,c,p,m,I;return(0,l.Z)(r[t],e)}));if(n.metadata){const t=X(n.metadata,r.metadata);t.length>0&&(e.metadata=t)}(0,p.Z)(e)||(i=[e])}return(0,m.Z)(s,[r.site_ID,r.ID],i)}),e);case w.oD3:{const s=t.siteId,r=t.postId||"",a=function(e,t){if((0,p.Z)(e))return[t];const s=(0,H.Z)(e);if("string"==typeof s)return[...e,t];const r=e.slice(0,-1);return r.push((0,J.Z)(s,t)),r}((0,u.Z)(e,[s,r]),t.post);return{...e,[s]:{...e[s],[r]:a}}}case w.gQI:return Object.assign({},e,{[t.siteId]:{...e[t.siteId],[t.postId||""]:null}});case w.cnn:if(!e.hasOwnProperty(t.siteId))break;return Object.assign({},e,{[t.siteId]:(0,i.Z)(e[t.siteId],t.postId||"")});case w.hZH:{const s=t.siteId;if(""===(t.postId||"")&&t.savedPost){const r=t.savedPost.ID;e={...e,[s]:(0,I.Z)(e[s],((e,t)=>""===t?r:t))}}return e}}return e},likes:R,revisions:M});(0,r.x)(["posts"],ae)},"./state/posts/utils/get-normalized-posts-query.js":(e,t,s)=>{s.d(t,{B:()=>n});var r=s("../node_modules/lodash-es/omitBy.js"),a=s("./state/posts/constants.js");function n(e){return(0,r.Z)(e,((e,t)=>a.e[t]===e))}},"./state/posts/utils/get-serialized-posts-query.js":(e,t,s)=>{s.d(t,{v:()=>a});var r=s("./state/posts/utils/get-normalized-posts-query.js");function a(e={},t){const s=(0,r.B)(e),a=JSON.stringify(s);return t?[t,a].join(":"):a}},"./state/posts/utils/merge-post-edits.js":(e,t,s)=>{s.d(t,{Z:()=>d});var r=s("../node_modules/lodash-es/reject.js"),a=s("../node_modules/lodash-es/find.js"),n=s("../node_modules/lodash-es/concat.js"),i=s("../node_modules/lodash-es/reduce.js"),o=s("../node_modules/lodash-es/mergeWith.js"),u=s("../node_modules/lodash-es/cloneDeep.js");const d=(...e)=>(0,i.Z)(e,((e,t)=>"string"==typeof t?e:null===e?t:(0,o.Z)((0,u.Z)(e),t,((e,t,s,i,o,u)=>"metadata"===s&&0===u.size?function(e,t){const s=(0,r.Z)(e,(e=>(0,a.Z)(t,{key:e.key})));return(0,n.Z)(s,t)}(e,t):Array.isArray(t)?t:void 0))),null)}}]);